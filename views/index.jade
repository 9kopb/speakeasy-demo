doctype html
html(lang='en')
  head
    title Speakeasy Demo
    script(type='text/javascript',src='https://code.jquery.com/jquery-2.1.4.min.js')
    link(type='text/css',rel='stylesheet',href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css')
    link(rel='stylesheet', href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/tomorrow.min.css')
    script(src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js')
    script(type='text/javascript').
      var updateTimer = function() {
        // Get current time seconds
        var sec = new Date().getSeconds();
        
        // Fire if clock has struck 0 or 30
        if (sec == 0 || sec == 30) {
          updateToken();
        } else {
          var secsToNext = 0;
          // If less than 30, next update is at 30
          if (sec < 30) {
            secsToNext = 30 - sec;
          } else if (sec > 30) {
            secsToNext = 60 - sec;
          }
          $('.update').text('Updating in ' + secsToNext + '...')
        }
      }
      var updateToken = function() {
        $.get('token?secret=' + $('#secret').text(), function( data ) {
          $('#token').text(data);
          $('.update').text('Updated.')
        });
      }
      $(document).ready(function() {
        $('pre').each(function(i, block) {
          hljs.highlightBlock(block);
        });
      });
      setInterval(updateTimer, 500)
    style(type='text/css').
      pre {
        overflow: auto;
        word-wrap: normal;
        white-space: pre;
      }
  body
    .container
      .row
        .col-md-12
          h1 Speakeasy Demo
      .row
        .col-md-4
          h2 Secret Key
          h3 Sample Code
          pre.
            var speakeasy = require("speakeasy")

            // Generate a secret key of length 20
            var secret = speakeasy.generate_key({length: 20})

            console.log(secret.base32)
        .col-md-4
          h2 QR Code
          h3 Sample Code
          pre.
            // Uses the otpauth:// protocol
            // as used in Google Authenticator
            
            var authURL = 'otpauth://totp/SecretKey?secret=' + encodeURIComponent(secret.base32);
            
            console.log(qr.toDataURL(authURL))
        .col-md-4
          h2 Generated Token
          h3 Sample Code
          pre.
            var token = speakeasy.time({
              key: secret.base32,
              encoding: 'base32'
            });

            console.log(token);
      .row
        .col-md-4
          p
            strong Secret:
          p#secret= secret.base32
        .col-md-4
          p Scan this in to Google Authenticator or another two-factor authentication app.
          img(src=qrPath, style='display: block; margin: auto; width: 200px;', width="200")
        .col-md-4
          p#token(style='font-size: 30pt; font-family: Monaco, Inconsolata, Consolas Helvetica, sans-serif;')=token
          p
            small.update Updating...
